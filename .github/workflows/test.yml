- name: Build and test ROS2 workspace
  run: |
    set -e
    # ROS2 環境を source
    if [ -f /opt/ros/jazzy/setup.bash ]; then
        source /opt/ros/jazzy/setup.bash
    else
        echo "setup.bash not found!"
        exit 1
    fi

    # 環境確認
    echo "CMAKE_PREFIX_PATH=$CMAKE_PREFIX_PATH"
    echo "AMENT_PREFIX_PATH=$AMENT_PREFIX_PATH"
    echo "PATH=$PATH"

    # ビルド
    colcon build --packages-select device_msgs mypkg --cmake-args -DBUILD_TESTING=OFF

    # テスト
    chmod +x ./src/mypkg/test/test.bash
    ./src/mypkg/test/test.bash

